<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Demo Setup</title>
    <link rel="icon" type="image/x-icon" href="assets/fabdicon.png">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 16px;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Firebase Demo Data Setup</h1>
        <p>This page will help you initialize demo pharmacy accounts in Firebase.</p>

        <div id="statusContainer"></div>

        <h3>Actions:</h3>
        <button id="checkFirebase" onclick="checkFirebaseConnection()">Check Firebase Connection</button>
        <button id="initDemo" onclick="initializeDemoData()" disabled>Initialize Demo Pharmacies</button>
        <button id="testLogin" onclick="testLogin()" disabled>Test Login</button>
        <button id="clearData" onclick="clearFirebaseData()">Clear Firebase Data</button>

        <h3>Demo Accounts:</h3>
        <pre>
Username: popular_pharmacy
Password: 123456

Username: square_pharmacy
Password: 123456
        </pre>

        <div id="logContainer">
            <h3>Console Log:</h3>
            <pre id="logArea"></pre>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-storage-compat.js"></script>

    <!-- Scripts -->
    <script src="js/firebase-config.js"></script>

    <script>
        let logArea = document.getElementById('logArea');

        function log(message) {
            console.log(message);
            logArea.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            logArea.scrollTop = logArea.scrollHeight;
        }

        function showStatus(message, type = 'info') {
            const statusContainer = document.getElementById('statusContainer');
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            statusContainer.appendChild(statusDiv);

            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (statusDiv.parentNode) {
                    statusDiv.parentNode.removeChild(statusDiv);
                }
            }, 5000);
        }

        async function checkFirebaseConnection() {
            log('Checking Firebase connection...');

            try {
                if (typeof firebase === 'undefined') {
                    throw new Error('Firebase SDK not loaded');
                }

                if (!window.MediMapDB || !window.MediMapDB.FirebaseUtils) {
                    throw new Error('Firebase utils not available');
                }

                const isAvailable = window.MediMapDB.FirebaseUtils.isFirebaseAvailable();

                if (isAvailable) {
                    showStatus('Firebase connection successful!', 'success');
                    log('Firebase is connected and ready');
                    document.getElementById('initDemo').disabled = false;
                    document.getElementById('testLogin').disabled = false;
                } else {
                    throw new Error('Firebase not properly initialized');
                }

            } catch (error) {
                showStatus('Firebase connection failed: ' + error.message, 'error');
                log('Firebase connection error: ' + error.message);
            }
        }

        async function initializeDemoData() {
            log('Initializing demo pharmacy data...');
            document.getElementById('initDemo').disabled = true;

            try {
                await window.MediMapDB.FirebaseUtils.initDemoPharmacies();
                showStatus('Demo pharmacies initialized successfully!', 'success');
                log('Demo pharmacy data initialization completed');
            } catch (error) {
                showStatus('Failed to initialize demo data: ' + error.message, 'error');
                log('Error initializing demo data: ' + error.message);
            } finally {
                document.getElementById('initDemo').disabled = false;
            }
        }

        async function testLogin() {
            log('Testing login with popular_pharmacy...');

            try {
                const result = await window.MediMapDB.PharmacyDB.getPharmacyByUsername('popular_pharmacy');

                if (result) {
                    showStatus('Test successful! Pharmacy found in Firebase', 'success');
                    log('Test login successful: ' + JSON.stringify(result, null, 2));
                } else {
                    showStatus('Test failed: Pharmacy not found', 'error');
                    log('Test login failed: Pharmacy not found');
                }

            } catch (error) {
                showStatus('Test failed: ' + error.message, 'error');
                log('Test login error: ' + error.message);
            }
        }

        async function clearFirebaseData() {
            if (!confirm('Are you sure you want to clear all pharmacy data from Firebase?')) {
                return;
            }

            log('Clearing Firebase pharmacy data...');

            try {
                if (!window.MediMapDB.FirebaseUtils.isFirebaseAvailable()) {
                    throw new Error('Firebase not available');
                }

                // Get all pharmacies and delete them
                const querySnapshot = await db.collection('pharmacies').get();
                const batch = db.batch();

                querySnapshot.forEach((doc) => {
                    batch.delete(doc.ref);
                });

                await batch.commit();

                showStatus('Firebase data cleared successfully!', 'success');
                log('All pharmacy data cleared from Firebase');

            } catch (error) {
                showStatus('Failed to clear data: ' + error.message, 'error');
                log('Error clearing Firebase data: ' + error.message);
            }
        }

        // Auto-check Firebase connection on load
        window.addEventListener('load', () => {
            setTimeout(checkFirebaseConnection, 1000);
        });
    </script>
</body>
</html>